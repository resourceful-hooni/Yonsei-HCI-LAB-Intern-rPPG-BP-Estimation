services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: visivital-backend
    environment:
      FLASK_HOST: 0.0.0.0
      FLASK_PORT: 5000
      FLASK_DEBUG: "False"
      DEMO_USER_ID: demo-user
      SECRET_KEY: change-this-in-production
      API_KEY: your-frontend-api-key
      DATABASE_PATH: /app/data/visi_vital.db
      CORS_ORIGINS: http://localhost:3000,http://127.0.0.1:3000,https://yonseihci.kro.kr,http://yonseihci.kro.kr,https://physicalai.duckdns.org,http://physicalai.duckdns.org
      RATE_LIMIT_PER_MINUTE: 100
      MAX_CONTENT_LENGTH: 80
      USE_DUMMY_GLUCOSE: "True"
      RESEARCH_BP_MODEL_PATH: ""
      RESEARCH_SCALER_INFO_PATH: ""
      RESEARCH_MODEL_TARGET_LEN: 875
    volumes:
      - ./data:/app/data
    ports:
      - "5000:5000"
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        REACT_APP_API_BASE_URL: /api
    container_name: visivital-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    restart: unless-stopped

  caddy:
    image: caddy:2.8-alpine
    container_name: visivital-caddy
    depends_on:
      - frontend
      - backend
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
